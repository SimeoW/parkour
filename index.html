<!DOCTYLE html>
<html>
  <head>
    <meta charset='utf-8'/>
    <meta name='viewport' content='user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width'>
    <style>
      html {
        height: 100%;
        margin: 0;
        padding: 0px;
        width: 100%;
      }
      body {
        background-color: #101010
      }
      canvas {
        height: 100%;
        left: 0;
        position: fixed;
        top: 0;
        width: 100%;
      }
      #viewport {
        z-index: -1;
      }
    </style>
    <script type='text/javascript' src='lib/three.js'></script>
    <script type='text/javascript' src='lib/physi.js'></script>
    <script type='text/javascript' src='lib/stinput.js'></script>
    <script type='text/javascript' src='lib/camera_orbit.js'></script>
    <script type='text/javascript' src='socket.io/socket.io.js'></script>
  </head>
  <body>
    <div id='viewport'></div>
  </body>
  <script type='text/javascript' src='game.js'></script>
  <script type='text/javascript'>
    'use strict';
    Physijs.scripts.worker = 'lib/physijs_worker.js';
    Physijs.scripts.ammo='ammo.js';
    
    const player_name = 'Guest';
    const server_name = '';

    const game = new Game();
    game.connect(player_name, server_name);
    
    // On window resize, resize the renderer as well
    window.addEventListener('resize', onWindowResize, false);
    function onWindowResize(){
      game.camera.aspect = window.innerWidth / window.innerHeight;
      game.camera.updateProjectionMatrix();
      game.renderer.setSize(window.innerWidth, window.innerHeight);
    }
  </script>
</html>

      let name = null, room, socket;

      function init() {
        name = (prompt('Hi! What is your name?', 'Guest') || 'Guest');
        room = (prompt('What room would you like to join?', '') || '')

        socket = io();
        socket.emit('init', name, room);
        
        socket.on('chat', function(msg){
          document.body.innerHTML += '<hr>' + msg;
        });

        socket.on('list', function(names){
          document.body.innerHTML += '<hr>Users online: ' + names.join(', ');
        });

        socket.on('rooms', function(rooms){
          for(let i in rooms) {
            let room = rooms[i][0], count = rooms[i][1];
            let unit = (count == 1 ? 'person' : 'people');
            rooms[i] = room + ' (' + count + ' ' + unit + ')'
          }
          document.body.innerHTML += '<hr>Rooms online:<br>' + rooms.join('<br>');
        });

        document.getElementById('textbox').addEventListener('keypress', function(e) {
          if(e.key == 'Enter') submit();
        });
      }

      function submit() {
        msg = document.getElementById('textbox').value.trim();
        document.getElementById('textbox').value = '';
        if(msg == '') return;

        console.log(socket)
        switch(msg) {
          case 'list':
            socket.emit('list');
            break
          case 'rooms':
            socket.emit('rooms');
            break;
          default:
            socket.emit('chat', msg);
        }
        document.getElementById('textbox').focus();
      }